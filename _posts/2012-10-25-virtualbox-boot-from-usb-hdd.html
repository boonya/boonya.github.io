---
layout: post
title: Как загрузиться с USB HDD в VirtualBox.
permalink: /blog/virtualbox-boot-from-usb-hdd.html
redirect_from: /my-blog/virtualbox-boot-from-usb-hdd.html
---
<p>Есть у меня компьютер с которым я постоянно работаю и развлекаюсь, в качестве операционной системы на нем крутится Windows 7. Так же у меня имеется переносной USB винчестер, на который я подшаманил в качестве загрузочной ОС Ubuntu Linux. Я её использую как "спасательную" операционку, типа Live CD, и иногда в ней работаю. В общем, подумал я, что было бы не плохо иметь возможность загружать эту ОСь в VirtualBox. Понасоскребав различных инструкций из мануалов и интернетов я составил свой рецепт, как это делать.</p>
<p>И так, <strong>запускаем<strong> в VirtualBox</strong> Ubuntu Linux установленную на USB HDD</strong>, как обычную виртуальную машину. Кстати, для флешек этот рецепт так же подходит...</p>

<!--more-->

<p><img src="https://googledrive.com/host/0BxJRQxIajdRxRXVZNkZVRDl1a3c/blog/virtualbox-boot-from-usb-hdd/01.jpg" alt="Ubuntu Linux в VirtualBox" /></p>

<h4>Дано:</h4>
<ul>
    <li>Компьютер с Windows 7 x64</li>
    <li>Загрузочный USB HDD с Ubuntu 12.04TLS</li>
</ul>

<h4>Задача:</h4>
<p>Запустить Ubuntu, установленную на USB Hard Disk Drive, внутри VirtualBox и пользоваться двумя системами параллельно.</p>

<h4>Решение:</h4>
<p>Для начала нужно <strong>запустить коммандную строку</strong> (консоль, cmd.exe) <strong>от имени администратора (!!! <strong>ОБЯЗАТЕЛЬНО !!!</strong>)</strong>, если вы используете Windows 7 или Vista.</p>
<p><img src="https://googledrive.com/host/0BxJRQxIajdRxRXVZNkZVRDl1a3c/blog/virtualbox-boot-from-usb-hdd/02.png" alt="how to cmd start"/></p>

<p>И выполнить в ней следующие три команды.</p>
<kbd class="pre">
C:
cd "%PROGRAMFILES%\..\Program Files\Oracle\VirtualBox\"
VBoxManage internalcommands createrawvmdk -filename "%USERPROFILE%\USB-HDD-connector.vmdk" -rawdisk \\.\PhysicalDrive1
</kbd>

<h4>Теперь рассмотрим эти команды подробнее:</h4>
<p>Первая строка вам понадобится в случае если текущий путь в консоли начинается с раздела отличного от того, в который инсталлирован ваш VirtualBox.</p>
<p>Вторая строка определяет директорию в которой будут выполняться следующие команды. В моем случае - это <code>C:\Program&nbsp;Files\Oracle\VirtualBox\</code>", так как моя программа виртуализации установлена в папку, которую предлагают для установки её разработчики.</p>
<p>Третья команда создает файл <b>USB-HDD-connector.vmdk</b>, который будет связывать наш внешний HDD с операционной системой и VirtualBox. Именно этот файл и нужно будет добавить как первичный диск для загрузки вашей виртуальной машины. <b>НО!</b> Прежде чем выполнять эту команду, нужно уточнить номер, под которым ваш внешний жесткий диск известен системе.</p>

<h4>Как узнать номер диска с которогу вы хотите загружаться?</h4>
<p>А очень просто! Для этого нужно открыть панель "управление компьютером" раздел "управление дисками". Панель вызвать можно двумя способами:</p>
<ol>
    <li>Кликнуть правой кнопкой мыши на ярлыке "мой компьютер" и выбрать в меню строку "управление";</li>
    <li>Выполнить команду <code>%windir%\system32\compmgmt.msc /s</code>. Для этого нажмите <kbd>Win + R</kbd>, введите эту команду и нажмите <kbd>enter</kbd>.</li>
</ol>
<p>Лично я предпочитаю второй вариант, правда для этого нужно помнить эту команду. Благо я однажды добавил в панель инструментов своего TotalCommander'а кнопку, которая открывает окно "управление компьютером". Что, то я отвлекся...</p>
<p>В разделе "управление дисками" ищем свой диск. Диск 0, Диск 1, Диск 2... Цифры - это и есть номера дисков.</p>

<p><img src="https://googledrive.com/host/0BxJRQxIajdRxRXVZNkZVRDl1a3c/blog/virtualbox-boot-from-usb-hdd/03.png" alt="pс managment" /></p>

<p>В моем случае - это был <b>Диск 1</b>. Так вот, в вышеописаной команде есть такая подстрока <code>\\.\PhysicalDrive1</code>. Последняя цифра здесь должна совпадать с номером диска, который вы узнали в панели управления компьютером.</p>
<p>Ещё один момент, который я хотел бы описать - это место где будет создан нужный нам файл. В моем варианте - <code>%USERPROFILE%\USB-HDD-connector.vmdk</code> - это значит, что в папке <code>%USERPROFILE%</code> <i>(это системная переменная Windows, которая будет заменена интерпретатором командной строки на путь к папке пользователя, под которым вы авторизованы в системе)</i> будет создан файл <code>USB-HDD-connector.vmdk</code>. Конечно же вы можете использовать здель любое удобное вам имя файла и путь, но если в этой строке есть пробелы, то её обязательно нужно заключить в кавычки. Иначе интерпретатор воспримйет этот пробел как переход к следующей инструкции.</p>

<h4>В итоге в вашей консоли должа быть примерно следующая картина:</h4>
<p><img src="https://googledrive.com/host/0BxJRQxIajdRxRXVZNkZVRDl1a3c/blog/virtualbox-boot-from-usb-hdd/04.png" alt="cmd" /></p>
<p>В случае успешного выполнения команды и создания файла связи вы увидите ответ: <kbd>RAW host disk access VMDK file %userpofile%\USB-HDD-connector.vmdk created successfully</kbd>". Вооот. Осталось дело за малым - создать виртуальную машину и выбрать в качестве жесткого диска файл, который мы только что создали. Ах да... И включить его как "первичный мастер".</p>
<p><img src="https://googledrive.com/host/0BxJRQxIajdRxRXVZNkZVRDl1a3c/blog/virtualbox-boot-from-usb-hdd/05.png" alt="virtual machine" /></p>
<p>Сразу хотелось бы предупредить, что VirtualBox может ругаться на то, что такого диска не существует и виртуальная машина не запустится. Это связано с тем, что у пользователя под которым вы авторизованы в системе недостаточно прав. Чтобы обойти эту неприятность запустите ваш VirtualBox от имени администратора.</p>
